import{z as v,E as R,I as x,J as _,K as D,N as U,j as e,d as B,n as M,a as d,o as T,O as w,T as g,x as P,Q as q,r as y,U as C,G as i,B as E,V as O,W as b,v as j,X as k,Y,Z as I,$ as V,e as z,a0 as A,a1 as $,a2 as W,a3 as Z,M as G,a4 as K}from"./index.e3bdf26a.js";import{d as J}from"./index.0d8b1815.js";var Q=6e4;function H(n,t){v(2,arguments);var r=x(t);return R(n,r*Q)}function X(n){v(1,arguments);var t=_(n),r=t.getFullYear(),a=t.getMonth(),s=new Date(0);return s.setFullYear(r,a+1,0),s.setHours(0,0,0,0),s.getDate()}function ee(n,t){v(2,arguments);var r=_(n),a=_(t);return r.getTime()>a.getTime()}function te(n,t){v(2,arguments);var r=_(n),a=_(t);return r.getTime()<a.getTime()}function ne(n,t){v(2,arguments);var r=_(n),a=_(t);return r.getTime()===a.getTime()}function re(n,t){v(2,arguments);var r=_(n),a=x(t),s=r.getFullYear(),c=r.getDate(),o=new Date(0);o.setFullYear(s,a,15),o.setHours(0,0,0,0);var u=X(o);return r.setMonth(a,Math.min(c,u)),r}function S(n){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?S=function(r){return typeof r}:S=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},S(n)}function ae(n,t){if(v(2,arguments),S(t)!=="object"||t===null)throw new RangeError("values parameter must be an object");var r=_(n);return isNaN(r.getTime())?new Date(NaN):(t.year!=null&&r.setFullYear(t.year),t.month!=null&&(r=re(r,t.month)),t.date!=null&&r.setDate(x(t.date)),t.hours!=null&&r.setHours(x(t.hours)),t.minutes!=null&&r.setMinutes(x(t.minutes)),t.seconds!=null&&r.setSeconds(x(t.seconds)),t.milliseconds!=null&&r.setMilliseconds(x(t.milliseconds)),r)}function ie(n,t){v(2,arguments);var r=x(t);return H(n,-r)}function se(n){return n.reduce((a,s)=>{const c=ae(new Date(s.createdAt),{hours:0,minutes:0,seconds:0,milliseconds:0}),o=a.findIndex(u=>ne(u.date,c));return o>-1?(a[o].messages.push(s),a):[...a,{date:c,messages:[s]}]},[]).map(a=>{const s=a.messages.reduce((o,u)=>{const h=new Date(u.createdAt),l=o.findIndex(m=>!m.closed&&m.read===u.read&&m.senderId===u.senderId&&ee(h,m.since)&&te(h,m.to));return l>-1?(o[l].content.push(u),o):(o.length>0&&(o[o.length-1].closed=!0),[...o,{closed:!1,content:[u],read:u.read,senderId:u.senderId,since:ie(h,5),to:H(h,5)}])},[]),c=J(a.date,new Date);return{messages:s,title:c===0?"Hoy":c===-1?"Ayer":D(a.date,"dd MMMM/yyyy",{locale:U})}}).map(({messages:a,title:s})=>({messages:a.map(({content:c})=>c),title:s}))}function oe({color:n=B.color,size:t=B.size,...r}){return e("svg",{...r,height:t,viewBox:"0 0 48 48",width:t,xmlns:"http://www.w3.org/2000/svg",children:e("path",{d:"M24.05 41.7q-1.25 0-2.125-.875t-.875-2.075q0-1.2.875-2.1.875-.9 2.075-.9 1.25 0 2.1.9.85.9.85 2.1 0 1.2-.85 2.075-.85.875-2.05.875Zm0-14.75q-1.25 0-2.125-.875T21.05 24q0-1.25.875-2.1.875-.85 2.075-.85 1.25 0 2.1.85.85.85.85 2.05 0 1.25-.85 2.125t-2.05.875Zm0-14.7q-1.25 0-2.125-.875T21.05 9.25q0-1.25.875-2.125T24 6.25q1.25 0 2.1.875.85.875.85 2.125t-.85 2.125q-.85.875-2.05.875Z",fill:n})})}function F({classes:n,data:t}){const{data:r}=M(),a=t[0].senderUser;if(!r||!a)return null;const s=r.id===t[0].senderId;return e("div",{className:n.chatMessage,children:t.map((c,o)=>d("div",{className:T(n.chatMessage__content,{[n["chatMessage__content--end"]]:s}),children:[!s&&o===0&&e(w,{url:a.profileImage,size:"small"}),d("div",{className:T(n.chatMessage__content__message,{[n["chatMessage__content__message--margin"]]:o>0}),children:[e(g,{withLetterSpacing:!0,className:n.chatMessage__content__message__text,fontSize:14,children:c.content}),o===t.length-1&&e(g,{withLetterSpacing:!0,className:n.chatMessage__content__message__date,fontSize:10,children:D(new Date(c.createdAt),"hh:mm a")})]}),s&&o===0&&e(w,{url:a.profileImage,size:"small"})]},`chat_message_${c.id}_${o}`))})}function ce({chatId:n,classes:t,loading:r,messages:a}){const{data:s}=M(),c=se(a);return d(P,{children:[r&&e(q,{id:"chat-messages-loader",text:"Cargando"}),c.map(({messages:o,title:u},h)=>{const l=h===c.length-1?o.reduce((f,p)=>!p[0].read&&p[0].senderId!==(s==null?void 0:s.id)?f+p.length:f,0):0;let m=!1;return d("div",{className:t.chatBox__content__grouped,id:h===c.length-1?"chat-grouped-messages":void 0,children:[e(g,{className:t.chatBox__content__grouped__title,fontSize:12,fontWeight:500,children:u}),e("div",{className:t.chatBox__content__grouped__messages,children:o.map((f,p)=>l>0&&!f[0].read&&f[0].senderId!==(s==null?void 0:s.id)&&!m?(m=!0,d(y.exports.Fragment,{children:[d(g,{withLetterSpacing:!0,className:t.chatBox__content__grouped__messages__unread,fontSize:12,children:[l," mensaje",l===1?"":"s"," no le\xEDdo",l===1?"":"s"]}),e(F,{classes:t,data:f})]},`chat_message_${n}_${f.length}_${h}_${p}`)):e(F,{classes:t,data:f},`chat_message_${n}_${f.length}_${h}_${p}`))})]},`chat_grouped_message_${o.length}_${h}`)})]})}function le({user:n}){return e(C,{fullHeight:!0,children:d(i,{container:!0,alignItems:"center",direction:"column",justifyContent:"center",spacing:12,children:[e(i,{item:!0,children:e(w,{size:"big",url:n.profileImage})}),e(i,{item:!0,children:e(g,{variant:"title",children:n.username})}),d(i,{item:!0,children:[e(E,{fullWidth:!0,link:!0,color:"white",size:"small",to:O.replace(":username",n.username),variant:"outlined",children:"Ver perfil"}),e(E,{color:"error",onClick:()=>{},size:"small",style:{marginTop:12},children:"Borrar conversaci\xF3n"})]})]})})}function de({chatId:n,classes:t,user:r}){const[a,s]=y.exports.useState(""),c=y.exports.useRef(null),{loadRecentChats:o,readAllMessages:u}=b(),{data:h}=M(),[l,{loading:m}]=j(k,{onCompleted(){s(""),o(),setTimeout(()=>{c.current&&c.current.focus()},100)}});function f(N){s(N.target.value)}function p(){h&&u(n,h.id)}function L(N){N.key==="Enter"&&a.length>0&&l({variables:{chatId:n,content:a}})}return e("div",{className:t.chatBox__footer,children:e(i,{container:!0,children:e(i,{item:!0,xs:"auto",children:e("input",{autoComplete:"off",className:t.chatBox__footer__input,disabled:m,onChange:f,onFocus:p,onKeyDown:L,placeholder:`Mensaje para ${r.username}`,ref:c,value:a})})})})}function ue({classes:n,onClick:t,user:r}){return e("div",{className:n.chatBox__header,children:d(i,{container:!0,alignItems:"center",justifyContent:"space-between",children:[e(i,{item:!0,children:e("button",{className:n.chatBox__header__button,onClick:t,children:d(i,{container:!0,alignItems:"center",spacing:12,children:[e(i,{item:!0,children:e(w,{clickable:!0,url:r.profileImage,size:"small"})}),e(i,{item:!0,children:e(g,{variant:"subtitle",children:r.username})})]})})}),e(i,{item:!0,children:e(Y,{color:"white",onClick:t,size:"small",variant:"transparent",children:e(oe,{})})})]})})}function he({chatId:n}){const[t,r]=y.exports.useState(!1),[a,s]=y.exports.useState(!1),c=y.exports.useRef(null),{chats:o,loadChat:u}=b(),{data:h}=M(),l=o[n];if(y.exports.useEffect(()=>{l!=null&&l.chat||(s(!0),u(n).finally(()=>s(!1)))},[n]),y.exports.useEffect(()=>{!c.current||!(l!=null&&l.messages)||c.current.scrollTo(0,c.current.scrollHeight)},[l]),!(l!=null&&l.chat)||!h)return null;const m=l.chat.toId===h.id?l.chat.user:l.chat.toUser;return m?d(i,{container:!0,spacing:12,children:[e(i,{item:!0,style:{height:"calc(100vh - 48px - 50px)"},xs:t?9:12,children:d(C,{fullHeight:!0,noPadding:!0,className:I.chatBox,children:[e(ue,{classes:I,onClick:()=>r(!t),user:m}),e("div",{className:I.chatBox__content,ref:c,children:e(ce,{chatId:n,classes:I,loading:a,messages:l.messages})}),e(de,{chatId:n,classes:I,user:m})]})}),t&&e(i,{item:!0,xs:3,children:e(le,{classes:I,user:m})})]}):null}function me({data:n}){const{data:t}=M(),r=V();if(t==null)return null;const a=n.chat.toId===t.id?n.chat.user:n.chat.toUser;return a?e(z,{className:T(A.messagePreview,{[A["messagePreview--active"]]:r.pathname===$.replace(":chatId",n.chat.id.toString())}),to:$.replace(":chatId",n.chat.id.toString()),children:d(i,{container:!0,alignItems:"center",spacing:24,children:[e(i,{item:!0,children:e(w,{url:a.profileImage})}),e(i,{item:!0,xs:9,children:d(i,{container:!0,justifyContent:"space-between",children:[e(i,{item:!0,children:e(g,{withLetterSpacing:!0,fontSize:18,fontWeight:500,children:a.username})}),e(i,{item:!0,children:e(g,{fontSize:12,children:D(new Date(n.lastMessage.createdAt),"hh:mm a")})}),e(i,{item:!0,xs:10,children:d(g,{style:{color:"#6A6B70",display:"block",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},variant:"body",children:[n.lastMessage.senderId===t.id?"T\xFA: ":null,n.lastMessage.content]})}),Boolean(n.unread)&&e(i,{item:!0,children:e(W,{counter:n.unread})})]})})]})}):null}function ge(){return d(i,{container:!0,fullHeight:!0,alignItems:"center",direction:"column",justifyContent:"center",spacing:16,children:[e(i,{item:!0,xs:4,children:e("img",{alt:"Begin chat",src:"/images/begin-chat.svg",width:"100%"})}),e(i,{item:!0,children:d(i,{container:!0,alignItems:"center",direction:"column",spacing:4,children:[e(i,{item:!0,children:e(g,{variant:"title",children:"Selecciona una conversaci\xF3n"})}),e(i,{item:!0,children:d(g,{variant:"body",children:["Si no tienes una conversaci\xF3n puedes buscar"," ",e(z,{to:"/explore",children:"nuevas conexiones"})]})})]})})]})}function pe(){const{recentChats:n}=b(),{chatId:t}=Z();return e(G,{children:e(i,{item:!0,xs:12,children:d(i,{container:!0,fullHeight:!0,spacing:12,children:[e(i,{item:!0,children:e("div",{style:{height:"calc(100vh - 48px)",maxHeight:"calc(100vh - 48px)",width:320},children:d(C,{fullHeight:!0,noPadding:!0,children:[e(g,{withLetterSpacing:!0,component:"h3",style:{padding:"16px 24px"},variant:"title",children:"Conversaciones"}),n.length>0?n.map((r,a)=>e(me,{data:r},`chat_${r.chat.id}_${a}`)):e(i,{container:!0,alignItems:"center",direction:"column",children:e(i,{item:!0,children:e(g,{children:"No tienes conversaciones"})})})]})})}),d(i,{item:!0,xs:"auto",children:[e(K,{}),e("div",{style:{marginTop:12},children:t?e(he,{chatId:t}):e(ge,{})})]})]})})})}export{pe as default};
