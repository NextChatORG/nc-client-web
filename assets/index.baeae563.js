import{j as e,d as I,a as c,ap as h,T as m,G as o,B as b,u as O,s as y,n as L,a2 as ne,U,af as N,e as A,aq as R,o as se,r as f,A as re,t as ie,v as C,x as k,Y as T,ag as oe,ar as le,as as ce,at as ue,au as de,av as _e,ac as ge}from"./index.9d37d7bc.js";import{U as me}from"./forms.1982493b.js";import{E as he,D as fe}from"./Divider.360e528f.js";import{T as pe}from"./TwoFactorCode.97693d04.js";import{d as ve}from"./index.1ed9b2a3.js";function we({color:t=I.color,size:n=I.size,...l}){return e("svg",{...l,height:n,viewBox:"0 0 48 48",width:n,xmlns:"http://www.w3.org/2000/svg",children:e("path",{d:"M18.9 35.7 7.7 24.5l2.15-2.15 9.05 9.05 19.2-19.2 2.15 2.15Z",fill:t})})}function P({actions:t,children:n,onClose:l,title:s}){function u(i){i.key==="Enter"&&l()}return c("div",{className:h.dialog,children:[e("div",{className:h.dialog__bg,onClick:l,onKeyPress:u,role:"button",tabIndex:0}),c("div",{className:h.dialog__content,children:[s&&e(m,{className:h.dialog__content__title,variant:"title",children:s}),e("div",{className:h.dialog__content__content,children:n}),t&&t.length>0&&e(o,{container:!0,alignItems:"center",className:h.dialog__content__actions,justifyContent:"flex-end",spacing:12,children:t.map((i,d)=>e(o,{item:!0,children:e(b,{...i,children:i.message})},`dialog_action_${d}`))})]})]})}function Ce({loading:t=!1,onClose:n,onSave:l,submitText:s="Continuar"}){const{control:u,handleSubmit:i}=O();function d(_){l(_.password)}return e(P,{actions:[{loading:t,onClick:i(d),message:s,size:"small"}],onClose:n,title:"Confirma tu contrase\xF1a",children:e(y,{required:!0,fullWidth:!0,control:u,defaultValue:"",placeholder:"Contrase\xF1a",name:"password",type:"password"})})}const Fe="_settings__subtitle_ahdtj_1",Te="_settings__divider_ahdtj_5",be="_settings__nav__title_ahdtj_9",xe="_settings__nav__ul_ahdtj_15",Se="_settings__nav__ul__li_ahdtj_20",g={settings__subtitle:Fe,settings__divider:Te,settings__nav__title:be,settings__nav__ul:xe,settings__nav__ul__li:Se,"settings__nav__ul__li--active":"_settings__nav__ul__li--active_ahdtj_27"};function Ee(){var s,u,i,d;const{data:t}=L(),n=ne();function l(_){return se(g.settings__nav__ul__li,{[g["settings__nav__ul__li--active"]]:n.pathname===_})}return e(U,{children:c("nav",{className:g.settings__nav,children:[e(m,{withLetterSpacing:!0,className:g.settings__nav__title,component:"h4",children:"Navegaci\xF3n"}),c("ul",{className:g.settings__nav__ul,children:[e("li",{className:l(N.replace(":username",(s=t==null?void 0:t.username)!=null?s:"")),children:e(A,{to:N.replace(":username",(u=t==null?void 0:t.username)!=null?u:""),children:"General"})}),e("li",{className:l(R.replace(":username",(i=t==null?void 0:t.username)!=null?i:"")),children:e(A,{to:R.replace(":username",(d=t==null?void 0:t.username)!=null?d:""),children:"Cambiar contrase\xF1a"})})]})]})})}function Ie(){var x,S;const[t,n]=f.exports.useState(null),[l,s]=f.exports.useState(!1),[u,i]=f.exports.useState(""),[d,_]=f.exports.useState("input"),p=f.exports.useRef(null),{clearErrors:z,control:j,getValues:D,handleSubmit:G,setError:M,setValue:Q}=O(),{dispatch:v}=f.exports.useContext(re),V=ie(),{data:r,logInTwoFactor:B}=L({onLogInTwoFactorCompleted(){_("success"),i(""),n(null)},onLogInTwoFactorErrors(){_("error"),setTimeout(()=>{_("input"),p.current&&(p.current.value="",p.current.dispatchEvent(new Event("input")),p.current.focus())},500)}}),[W,{loading:q}]=C(ce,{onCompleted({changeUsername:a}){!a||!v||(s(!1),n(null),v({type:"change-access-token",payload:{accessToken:a.accessToken,profileData:a.profile}}),V(le))},onError({fields:a}){if(a.length>0){s(!1);for(const E of a)M(E.field,{message:E.message})}}}),[$,{loading:H}]=C(ue,{onCompleted({generateTwoFactorQRCode:a}){i(a),s(!1),n("scan_two_factor")}}),[K]=C(de,{onCompleted({verifyTwoFactorCode:a}){!a||B({code:a})}}),[Y,{loading:Z}]=C(_e,{onCompleted({disableTwoFactor:a}){!a||!v||(v({type:"update-profile-data",payload:{settings:{twoFactorEnabled:!1}}}),n(null))}});function J(){var a;n(null),z(),Q("username",(a=r==null?void 0:r.username)!=null?a:"")}function X(){s(!1)}function ee(){s(!0),n("enable_two_factor")}function te(){s(!0),n("disable_two_factor")}async function ae(a){switch(t){case"change_username":{await W({variables:{password:a,username:D().username}});break}case"enable_two_factor":{await $({variables:{currentPassword:a}});break}case"disable_two_factor":{await Y({variables:{currentPassword:a}});break}}}const F=(x=r==null?void 0:r.settings)!=null&&x.lastUsernameChanged?ve(new Date(r.settings.lastUsernameChanged),new Date):60,w=F>=60;return c(k,{children:[c(U,{children:[e(m,{withLetterSpacing:!0,className:g.settings__subtitle,variant:"subtitle",children:"Informaci\xF3n general"}),e(y,{fullWidth:!0,control:j,defaultValue:r==null?void 0:r.username,disabled:!w||t!=="change_username",endAdorment:w&&(t==="change_username"?c("div",{style:{alignItems:"center",display:"flex",gap:"4px"},children:[e(T,{color:"success",onClick:G(()=>s(!0)),size:"small",variant:"transparent",children:e(we,{fontSize:"1.5em"})}),e(T,{color:"error",onClick:J,size:"small",variant:"transparent",children:e(oe,{fontSize:"1.5em"})})]}):e(T,{color:"white",onClick:()=>n("change_username"),size:"small",variant:"transparent",children:e(he,{size:"1.5em"})})),helperText:w?"Recuerda que no podr\xE1s cambiar tu nombre de usuario nuevamente hasta dentro de 60 d\xEDas":`No puedes cambiar tu nombre de usuario hasta dentro de ${60-F} d\xEDa${60-F===1?"":"s"}`,label:"Nombre de usuario",name:"username",validations:w&&me}),e(fe,{className:g.settings__divider}),e(m,{withLetterSpacing:!0,className:g.settings__subtitle,variant:"subtitle",children:"Autenticaci\xF3n en dos factores (2AF)"}),c(o,{container:!0,alignItems:"center",justifyContent:"space-between",children:[e(o,{item:!0,xs:8,children:e(m,{withLetterSpacing:!0,fontSize:12,children:"La autenticaci\xF3n en dos factores (2FA) es una buena forma de a\xF1adir una capa extra de seguridad a tu cuenta de NextChat, para asegurarte que solo t\xFA puedes ingresar a tu cuenta."})}),e(o,{item:!0,children:(S=r==null?void 0:r.settings)!=null&&S.twoFactorEnabled?e(b,{color:"error",onClick:te,size:"small",variant:"outlined",children:"Desactivar 2FA"}):e(b,{color:"success",onClick:ee,size:"small",variant:"outlined",children:"Activar 2FA"})})]})]}),t==="scan_two_factor"&&e(P,{onClose:()=>{},title:"Autenticaci\xF3n en dos factores",children:c(o,{container:!0,alignItems:"center",direction:"column",spacing:12,children:[e(o,{item:!0,children:e(m,{withLetterSpacing:!0,fontSize:12,children:"Escanea el siguiente c\xF3digo QR con tu aplicaci\xF3n"})}),e(o,{item:!0,children:e("img",{alt:"Two Factor QR Code",src:u,style:{borderRadius:12,overflow:"hidden"}})}),e(o,{item:!0,children:e(m,{withLetterSpacing:!0,component:"p",fontSize:12,style:{marginTop:20},children:"Ingresa el c\xF3digo de 6 digitos generado en la aplicaci\xF3n"})}),e(o,{item:!0,children:e(pe,{inputRef:p,onSubmit:a=>K({variables:{code:a}}),setState:_,state:d})})]})}),l&&t&&e(Ce,{loading:q||H||Z,onClose:X,onSave:ae,submitText:t==="change_username"?"Cambiar nombre de usuario":t==="enable_two_factor"?"Generar C\xF3digo QR":"Desactivar 2FA"})]})}function Le(){const t=ge();return c(k,{children:[e(o,{item:!0,xs:3,children:e(Ee,{})}),e(o,{item:!0,xs:9,children:t!=null?t:e(Ie,{})})]})}export{Le as default};
