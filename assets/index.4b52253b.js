import{a as l,c as P,j as n,d as q,r as o,W as T,e as k,U as Z,E as j,B as f,X as H,n as z,O as G,Y as B,q as x,Z as Y,_ as $,M as V,$ as D,N as W,a0 as X,y as J,a1 as K,a2 as ee,a3 as N,a4 as ne,a5 as se,a6 as te,a7 as re}from"./index.b8cddd1d.js";import{E as ie}from"./Edit.f1d65ee8.js";const ae={horizontal:"flex-row justify-between",vertical:"flex-col"};function le({layout:e="horizontal",name:t,value:r}){return l("div",{className:P("flex",ae[e]),children:[n("p",{className:"font-medium tracking-wide",children:t}),n("p",{className:"text-[14px]",children:r})]})}function ce({color:e=q.color,size:t=q.size,...r}){return n("svg",{...r,height:t,viewBox:"0 0 48 48",width:t,xmlns:"http://www.w3.org/2000/svg",children:n("path",{d:"M22.2 28.3h3.6v-6.5h6.5v-3.6h-6.5v-6.5h-3.6v6.5h-6.5v3.6h6.5ZM2.75 45.25V7.45q0-1.9 1.375-3.325Q5.5 2.7 7.45 2.7h33.1q1.9 0 3.325 1.425Q45.3 5.55 45.3 7.45v25.1q0 1.9-1.425 3.3t-3.325 1.4h-29.8Zm4.7-10.3 2.4-2.4h30.7V7.45H7.45Zm0-27.5v27.5Z",fill:e})})}function de({color:e=q.color,size:t=q.size,...r}){return n("svg",{...r,height:t,viewBox:"0 0 48 48",width:t,xmlns:"http://www.w3.org/2000/svg",children:n("path",{d:"M37.2 26.4v-6.2H31v-3.6h6.2v-6.2h3.6v6.2H47v3.6h-6.2v6.2Zm-18.95-3.1q-3.9 0-6.35-2.45-2.45-2.45-2.45-6.3 0-3.85 2.45-6.3 2.45-2.45 6.35-2.45 3.85 0 6.3 2.45Q27 10.7 27 14.55q0 3.85-2.45 6.3-2.45 2.45-6.3 2.45ZM.95 41.9v-6.05q0-2.1 1.1-3.8 1.1-1.7 3-2.6 3.85-1.7 6.925-2.4 3.075-.7 6.275-.7t6.275.7q3.075.7 6.825 2.4 1.9.9 3.025 2.575Q35.5 33.7 35.5 35.85v6.05Zm4.75-4.7h25.1v-1.15q0-.75-.425-1.45t-1.225-1.05q-3.3-1.55-5.65-2-2.35-.45-5.25-.45-2.85 0-5.275.475-2.425.475-5.675 1.975-.8.35-1.2 1.05-.4.7-.4 1.45Zm12.5-18.6q1.8 0 2.95-1.15 1.15-1.15 1.15-2.9 0-1.8-1.15-2.925Q20 10.5 18.25 10.5q-1.8 0-2.925 1.125Q14.2 12.75 14.2 14.55q0 1.75 1.125 2.9T18.2 18.6Zm.05-4.05Zm0 16.55Z",fill:e})})}const M=12;function oe({total:e,userId:t}){const[r,i]=o.exports.useState(!1),[v,E]=o.exports.useState([]),[m,p]=o.exports.useState(0),[S,{loading:u}]=T(H,{fetchPolicy:"network-only"});async function g(a){const{data:c}=await S({variables:{page:a,perPage:M,userId:t}});c!=null&&c.getFriends&&E(h=>Array.from(new Set(h.concat(c.getFriends))))}function R(){return(m+1)*(M+1)<e}function I(){i(!0),window.addEventListener("scroll",function(){if(!r)return;const{clientHeight:a,scrollHeight:c,scrollTop:h}=document.documentElement;h+a>=c-5&&R()&&(p(_=>_+1),g(m+1))},{passive:!0})}return o.exports.useEffect(()=>{g(0)},[]),o.exports.useEffect(()=>{i(!1),E([]),p(0),g(0)},[t]),l("div",{className:"content",children:[l("h2",{className:"text-subtitle mb-2",children:["Amigos (",e,")"]}),n("div",{className:"flex flex-wrap gap-2",children:v.map((a,c)=>l(k,{className:"flex flex-col items-center gap-1 hover:no-underline",to:Z.replace(":username",a.username),children:[n("img",{alt:`${a.username}'s profile`,className:"avatar-normal",src:a.profileImage}),n("p",{className:"text-body tracking-wide",children:a.username})]},`profile_friend_${a.id}_${c}`))}),l("div",{className:"flex justify-center",children:[u&&n(j,{id:`profile-friends-${t}`,text:"Cargando..."}),!r&&!u&&R()&&n(f,{color:"white",onClick:I,size:"small",variant:"outlined",children:"Cargar m\xE1s"})]})]})}function me(){var w,A,U;const[e,t]=o.exports.useState(null),{data:r}=z(),{username:i}=G(),v=B(),[E,{data:m,subscribeToMore:p}]=T(K),[S,{data:u}]=T(ee),[g,{loading:R}]=x(ne,{onCompleted({sendFriendRequest:d}){!d||t({...N,canUnSendFriendRequest:!0})}}),[I,{loading:a}]=x(se,{onCompleted({cancelFriendRequest:d}){!d||t({...N,canSendFriendRequest:!0})}}),[c,{loading:h}]=x(te,{onCompleted({acceptFriendRequest:d}){!d||t({...N,canSendMessage:!0})}}),[_,{loading:C}]=x(re,{onCompleted({declineFriendRequest:d}){!d||t({...N,canSendMessage:!0})}});function O(){if(!(!(s!=null&&s.id)||!(e!=null&&e.canSendFriendRequest)))return g({variables:{userId:s.id}})}function y(){if(!(!(s!=null&&s.id)||!(e!=null&&e.canUnSendFriendRequest)))return I({variables:{userId:s.id}})}function L(){if(!(!(s!=null&&s.id)||!(e!=null&&e.canAcceptFriendRequest)))return c({variables:{userId:s.id}})}function Q(){if(!(!(s!=null&&s.id)||!(e!=null&&e.canDeclineFriendRequest)))return _({variables:{userId:s.id}})}const F=i===(r==null?void 0:r.username),s=i?F?r:(w=m==null?void 0:m.getProfile)!=null?w:null:r;return o.exports.useEffect(()=>{i&&i.length>=4&&!F&&E({variables:{username:i}})},[i]),o.exports.useEffect(()=>{s!=null&&s.actions&&(t(Y(s.actions)),F||S({variables:{userId:s.id}}))},[s]),o.exports.useEffect(()=>{i&&!F&&p({document:$,variables:{username:i},updateQuery(d,{subscriptionData:b}){return b.data?{getProfile:{...d.getProfile,actions:b.data.profileActionsChanged.actions}}:d}})},[]),l(V,{header:{withOffset:!0},children:[v,s&&!v&&l("div",{className:"basis-full flex flex-wrap gap-2 pt-2",children:[n("div",{className:"basis-full lg:basis-1/3 xl:basis-1/5",children:l("div",{className:"relative content pt-5",children:[l("div",{className:P("w-full absolute left-0 top-0 transform -translate-y-1/2","px-2 flex items-center justify-center gap-1"),children:[n("div",{children:e!=null&&e.canAcceptFriendRequest?n(f,{loading:h||C,onClick:L,size:"small",children:"Aceptar solicitud"}):null}),n("div",{children:e!=null&&e.isMe?n(f,{link:!0,startIcon:n(ie,{}),to:D.replace(":username",s.username),children:"Editar perfil"}):(e==null?void 0:e.canSendMessage)&&(u==null?void 0:u.getChat)?n(f,{link:!0,startIcon:n(ce,{}),to:W.replace(":chatId",u.getChat.id.toString()),children:"Enviar mensaje"}):e!=null&&e.canSendFriendRequest?n(f,{loading:R,onClick:O,startIcon:n(de,{}),children:"Enviar solicitud"}):e!=null&&e.canUnSendFriendRequest?n(f,{color:"error",loading:a,onClick:y,startIcon:n(X,{}),children:"Cancelar solicitud"}):e!=null&&e.canDeclineFriendRequest?n(f,{color:"error",loading:h||C,onClick:Q,size:"small",children:"Rechazar solicitud"}):null})]}),l("div",{className:"flex flex-wrap justify-center gap-2",children:[l("div",{className:"basis-full flex flex-col items-center gap-1",children:[n("img",{alt:"Profile avatar",className:"avatar-big",src:s.profileImage}),n("span",{className:"text-[20px] font-medium tracking-wide",children:s.username})]}),n("div",{className:"basis-full divider"}),n("div",{className:"basis-full",children:s.createdAt&&n(le,{name:"Registro",value:J(new Date(s.createdAt),"MMMM yyyy")})})]})]})}),n("div",{className:"<lg:basis-full lg:flex-1",children:n(oe,{total:(U=(A=s.counters)==null?void 0:A.friends)!=null?U:0})})]})]})}export{me as default};
