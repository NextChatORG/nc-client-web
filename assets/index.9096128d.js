import{j as e,d as S,u as R,s as O,n as L,$ as te,U,a as l,T as f,ab as E,e as A,al as I,o as ne,r as h,A as re,t as se,v as C,x as y,Y as T,ac as oe,G as o,B as N,am as ie,an as ce,ao as le,ap as ue,aq as de,a8 as me}from"./index.e3bdf26a.js";import{D as k,c as u}from"./Settings.module.50dd780c.js";import{U as ge}from"./forms.1982493b.js";import{E as he,D as fe}from"./Divider.385c9cb1.js";import{T as pe}from"./TwoFactorCode.62d93713.js";import{d as _e}from"./index.0d8b1815.js";function we({color:a=S.color,size:n=S.size,...i}){return e("svg",{...i,height:n,viewBox:"0 0 48 48",width:n,xmlns:"http://www.w3.org/2000/svg",children:e("path",{d:"M18.9 35.7 7.7 24.5l2.15-2.15 9.05 9.05 19.2-19.2 2.15 2.15Z",fill:a})})}function Ce({loading:a=!1,onClose:n,onSave:i,submitText:s="Continuar"}){const{control:m,handleSubmit:d}=R();function g(c){i(c.password)}return e(k,{actions:[{loading:a,onClick:d(g),message:s,size:"small"}],onClose:n,title:"Confirma tu contrase\xF1a",children:e(O,{required:!0,fullWidth:!0,control:m,defaultValue:"",placeholder:"Contrase\xF1a",name:"password",type:"password"})})}function Fe(){var s,m,d,g;const{data:a}=L(),n=te();function i(c){return ne(u.settings__nav__ul__li,{[u["settings__nav__ul__li--active"]]:n.pathname===c})}return e(U,{children:l("nav",{className:u.settings__nav,children:[e(f,{withLetterSpacing:!0,className:u.settings__nav__title,component:"h4",children:"Navegaci\xF3n"}),l("ul",{className:u.settings__nav__ul,children:[e("li",{className:i(E.replace(":username",(s=a==null?void 0:a.username)!=null?s:"")),children:e(A,{to:E.replace(":username",(m=a==null?void 0:a.username)!=null?m:""),children:"General"})}),e("li",{className:i(I.replace(":username",(d=a==null?void 0:a.username)!=null?d:"")),children:e(A,{to:I.replace(":username",(g=a==null?void 0:a.username)!=null?g:""),children:"Cambiar contrase\xF1a"})})]})]})})}function Te(){var b,v;const[a,n]=h.exports.useState(null),[i,s]=h.exports.useState(!1),[m,d]=h.exports.useState(""),[g,c]=h.exports.useState("input"),p=h.exports.useRef(null),{clearErrors:z,control:D,getValues:P,handleSubmit:G,setError:M,setValue:Q}=R(),{dispatch:_}=h.exports.useContext(re),V=se(),{data:r,logInTwoFactor:W}=L({onLogInTwoFactorCompleted(){c("success"),d(""),n(null)},onLogInTwoFactorErrors(){c("error"),setTimeout(()=>{c("input"),p.current&&(p.current.value="",p.current.dispatchEvent(new Event("input")),p.current.focus())},500)}}),[B,{loading:j}]=C(ce,{onCompleted({changeUsername:t}){!t||!_||(s(!1),n(null),_({type:"change-access-token",payload:{accessToken:t.accessToken,profileData:t.profile}}),V(ie))},onError({fields:t}){if(t.length>0){s(!1);for(const x of t)M(x.field,{message:x.message})}}}),[q,{loading:$}]=C(le,{onCompleted({generateTwoFactorQRCode:t}){d(t),s(!1),n("scan_two_factor")}}),[H]=C(ue,{onCompleted({verifyTwoFactorCode:t}){!t||W({code:t})}}),[Y,{loading:Z}]=C(de,{onCompleted({disableTwoFactor:t}){!t||!_||(_({type:"update-data",payload:{profile:{settings:{twoFactorEnabled:!1}}}}),n(null))}});function J(){var t;n(null),z(),Q("username",(t=r==null?void 0:r.username)!=null?t:"")}function K(){s(!1)}function X(){s(!0),n("enable_two_factor")}function ee(){s(!0),n("disable_two_factor")}async function ae(t){switch(a){case"change_username":{await B({variables:{password:t,username:P().username}});break}case"enable_two_factor":{await q({variables:{currentPassword:t}});break}case"disable_two_factor":{await Y({variables:{currentPassword:t}});break}}}const F=(b=r==null?void 0:r.settings)!=null&&b.lastUsernameChanged?_e(new Date(r.settings.lastUsernameChanged),new Date):60,w=F>=60;return l(y,{children:[l(U,{children:[e(f,{withLetterSpacing:!0,className:u.settings__subtitle,variant:"subtitle",children:"Informaci\xF3n general"}),e(O,{fullWidth:!0,control:D,defaultValue:r==null?void 0:r.username,disabled:!w||a!=="change_username",endAdorment:w&&(a==="change_username"?l("div",{style:{alignItems:"center",display:"flex",gap:"4px"},children:[e(T,{color:"success",onClick:G(()=>s(!0)),size:"small",variant:"transparent",children:e(we,{fontSize:"1.5em"})}),e(T,{color:"error",onClick:J,size:"small",variant:"transparent",children:e(oe,{fontSize:"1.5em"})})]}):e(T,{color:"white",onClick:()=>n("change_username"),size:"small",variant:"transparent",children:e(he,{size:"1.5em"})})),helperText:w?"Recuerda que no podr\xE1s cambiar tu nombre de usuario nuevamente hasta dentro de 60 d\xEDas":`No puedes cambiar tu nombre de usuario hasta dentro de ${60-F} d\xEDa${60-F===1?"":"s"}`,label:"Nombre de usuario",name:"username",validations:w&&ge}),e(fe,{className:u.settings__divider}),e(f,{withLetterSpacing:!0,className:u.settings__subtitle,variant:"subtitle",children:"Autenticaci\xF3n en dos factores (2AF)"}),l(o,{container:!0,alignItems:"center",justifyContent:"space-between",children:[e(o,{item:!0,xs:8,children:e(f,{withLetterSpacing:!0,fontSize:12,children:"La autenticaci\xF3n en dos factores (2FA) es una buena forma de a\xF1adir una capa extra de seguridad a tu cuenta de NextChat, para asegurarte que solo t\xFA puedes ingresar a tu cuenta."})}),e(o,{item:!0,children:(v=r==null?void 0:r.settings)!=null&&v.twoFactorEnabled?e(N,{color:"error",onClick:ee,size:"small",variant:"outlined",children:"Desactivar 2FA"}):e(N,{color:"success",onClick:X,size:"small",variant:"outlined",children:"Activar 2FA"})})]})]}),a==="scan_two_factor"&&e(k,{onClose:()=>{},title:"Autenticaci\xF3n en dos factores",children:l(o,{container:!0,alignItems:"center",direction:"column",spacing:12,children:[e(o,{item:!0,children:e(f,{withLetterSpacing:!0,fontSize:12,children:"Escanea el siguiente c\xF3digo QR con tu aplicaci\xF3n"})}),e(o,{item:!0,children:e("img",{alt:"Two Factor QR Code",src:m,style:{borderRadius:12,overflow:"hidden"}})}),e(o,{item:!0,children:e(f,{withLetterSpacing:!0,component:"p",fontSize:12,style:{marginTop:20},children:"Ingresa el c\xF3digo de 6 digitos generado en la aplicaci\xF3n"})}),e(o,{item:!0,children:e(pe,{inputRef:p,onSubmit:t=>H({variables:{code:t}}),setState:c,state:g})})]})}),i&&a&&e(Ce,{loading:j||$||Z,onClose:K,onSave:ae,submitText:a==="change_username"?"Cambiar nombre de usuario":a==="enable_two_factor"?"Generar C\xF3digo QR":"Desactivar 2FA"})]})}function Ie(){const a=me();return l(y,{children:[e(o,{item:!0,xs:3,children:e(Fe,{})}),e(o,{item:!0,xs:9,children:a!=null?a:e(Te,{})})]})}export{Ie as default};
