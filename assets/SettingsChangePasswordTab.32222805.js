import{r as o,A as N,u as v,n as D,q as k,a as n,F as y,j as s,o as c,B as I,af as q,ag as R}from"./index.6fd775bf.js";import{P as E}from"./forms.1982493b.js";import{T as W}from"./TwoFactorCode.1104c81e.js";import{D as j}from"./Dialog.a88eb79a.js";import{d as O}from"./index.10730916.js";function M(){var m;const[p,l]=o.exports.useState(!1),[g,x]=o.exports.useState("input"),h=o.exports.useRef(null),{dispatch:u}=o.exports.useContext(N),{clearErrors:F,control:r,getValues:b,handleSubmit:C,setValue:i,watch:P}=v(),{data:e}=D(),[w,{loading:S}]=k(R,{onCompleted({changePassword:t}){!u||(u({type:"update-data",payload:{accessToken:t,profile:{settings:{lastPasswordChanged:new Date().getTime()}}}}),l(!1),q.success("\xA1Has cambiado tu contrase\xF1a correctamente!"),F(),i("currentPassword",""),i("newPassword",""),i("confirmNewPassword",""))}});function T(t){var f;if(!((f=e==null?void 0:e.settings)!=null&&f.twoFactorEnabled))return w({variables:t});l(!0)}const d=(m=e==null?void 0:e.settings)!=null&&m.lastPasswordChanged?O(new Date,new Date(e.settings.lastPasswordChanged)):16,a=d>=16,A=P("newPassword");return n(y,{children:[n("div",{className:"content flex flex-col items-end content-end justify-end gap-2",children:[s("h3",{className:"block w-full mb-2 text-title tracking-wide",children:"Cambiar contrase\xF1a"}),!a&&n("p",{className:"block w-full -mt-2 text-[13px] tracking-wide",children:["Debes esperar ",16-d," d\xEDa",16-d===1?"":"s"," para volver a cambiar tu contrase\xF1a."]}),s(c,{fullWidth:!0,required:!0,control:r,disabled:!a,label:"Contrase\xF1a actual",name:"currentPassword",type:"password"}),s(c,{fullWidth:!0,required:!0,control:r,disabled:!a,label:"Nueva contrase\xF1a",name:"newPassword",type:"password",validations:a&&E}),s(c,{fullWidth:!0,required:!0,control:r,disabled:!a,label:"Confirma la nueva contrase\xF1a",name:"confirmNewPassword",type:"password",validations:a&&{validate(t){return A===t||"Las contrase\xF1as no coinciden"}}}),s(I,{disabled:!a,loading:S,onClick:C(T),children:"Cambiar"})]}),p&&n(j,{onClose:()=>{},title:"Autenticaci\xF3n en dos factores",children:[s("p",{className:"text-center text-[12px] tracking-wide",children:"Ingresa el c\xF3digo de 6 digitos generado en la aplicaci\xF3n"}),s(W,{className:"mt-1 mx-auto",inputRef:h,onSubmit:t=>w({variables:{...b(),code:t}}),setState:x,state:g})]})]})}export{M as default};
