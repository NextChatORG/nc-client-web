import{z as _,E as P,I as x,J as g,K as T,N as q,j as t,d as B,n as w,a as u,o as N,O as M,T as f,x as O,Q as j,r as v,U as C,G as s,B as F,V as k,W as b,v as V,X as W,Y as Z,Z as I,$ as G,e as R,a0 as A,a1 as E,a2 as z,a3 as K,M as J,a4 as Q}from"./index.29945aa6.js";import{d as Y}from"./index.cb29fc0b.js";var X=6e4;function H(n,e){_(2,arguments);var r=x(e);return P(n,r*X)}function $(n,e){_(2,arguments);var r=g(n),a=g(e),i=r.getTime()-a.getTime();return i<0?-1:i>0?1:i}function ee(n,e){_(2,arguments);var r=g(n),a=g(e);return r.getFullYear()-a.getFullYear()}function te(n,e){_(2,arguments);var r=g(n),a=g(e),i=$(r,a),c=Math.abs(ee(r,a));r.setFullYear(1584),a.setFullYear(1584);var o=$(r,a)===-i,d=i*(c-Number(o));return d===0?0:d}function ne(n){_(1,arguments);var e=g(n),r=e.getFullYear(),a=e.getMonth(),i=new Date(0);return i.setFullYear(r,a+1,0),i.setHours(0,0,0,0),i.getDate()}function re(n,e){_(2,arguments);var r=g(n),a=g(e);return r.getTime()>a.getTime()}function ae(n,e){_(2,arguments);var r=g(n),a=g(e);return r.getTime()<a.getTime()}function ie(n,e){_(2,arguments);var r=g(n),a=g(e);return r.getTime()===a.getTime()}function se(n,e){_(2,arguments);var r=g(n),a=x(e),i=r.getFullYear(),c=r.getDate(),o=new Date(0);o.setFullYear(i,a,15),o.setHours(0,0,0,0);var d=ne(o);return r.setMonth(a,Math.min(c,d)),r}function S(n){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?S=function(r){return typeof r}:S=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},S(n)}function oe(n,e){if(_(2,arguments),S(e)!=="object"||e===null)throw new RangeError("values parameter must be an object");var r=g(n);return isNaN(r.getTime())?new Date(NaN):(e.year!=null&&r.setFullYear(e.year),e.month!=null&&(r=se(r,e.month)),e.date!=null&&r.setDate(x(e.date)),e.hours!=null&&r.setHours(x(e.hours)),e.minutes!=null&&r.setMinutes(x(e.minutes)),e.seconds!=null&&r.setSeconds(x(e.seconds)),e.milliseconds!=null&&r.setMilliseconds(x(e.milliseconds)),r)}function ce(n,e){_(2,arguments);var r=x(e);return H(n,-r)}function le(n){return n.reduce((a,i)=>{const c=oe(new Date(i.createdAt),{hours:0,minutes:0,seconds:0,milliseconds:0}),o=a.findIndex(d=>ie(d.date,c));return o>-1?(a[o].messages.push(i),a):[...a,{date:c,messages:[i]}]},[]).map(a=>{const i=a.messages.reduce((o,d)=>{const h=new Date(d.createdAt),l=o.findIndex(m=>!m.closed&&m.read===d.read&&m.senderId===d.senderId&&re(h,m.since)&&ae(h,m.to));return l>-1?(o[l].content.push(d),o):(o.length>0&&(o[o.length-1].closed=!0),[...o,{closed:!1,content:[d],read:d.read,senderId:d.senderId,since:ce(h,5),to:H(h,5)}])},[]),c=Y(a.date,new Date);return{messages:i,title:c===0?"Hoy":c===-1?"Ayer":T(a.date,"dd MMMM/yyyy",{locale:q})}}).map(({messages:a,title:i})=>({messages:a.map(({content:c})=>c),title:i}))}function ue({color:n=B.color,size:e=B.size,...r}){return t("svg",{...r,height:e,viewBox:"0 0 48 48",width:e,xmlns:"http://www.w3.org/2000/svg",children:t("path",{d:"M24.05 41.7q-1.25 0-2.125-.875t-.875-2.075q0-1.2.875-2.1.875-.9 2.075-.9 1.25 0 2.1.9.85.9.85 2.1 0 1.2-.85 2.075-.85.875-2.05.875Zm0-14.75q-1.25 0-2.125-.875T21.05 24q0-1.25.875-2.1.875-.85 2.075-.85 1.25 0 2.1.85.85.85.85 2.05 0 1.25-.85 2.125t-2.05.875Zm0-14.7q-1.25 0-2.125-.875T21.05 9.25q0-1.25.875-2.125T24 6.25q1.25 0 2.1.875.85.875.85 2.125t-.85 2.125q-.85.875-2.05.875Z",fill:n})})}function L({classes:n,data:e}){const{data:r}=w(),a=e[0].senderUser;if(!r||!a)return null;const i=r.id===e[0].senderId;return t("div",{className:n.chatMessage,children:e.map((c,o)=>u("div",{className:N(n.chatMessage__content,{[n["chatMessage__content--end"]]:i}),children:[!i&&o===0&&t(M,{url:a.profileImage,size:"small"}),u("div",{className:N(n.chatMessage__content__message,{[n["chatMessage__content__message--margin"]]:o>0}),children:[t(f,{withLetterSpacing:!0,className:n.chatMessage__content__message__text,fontSize:14,children:c.content}),o===e.length-1&&t(f,{withLetterSpacing:!0,className:n.chatMessage__content__message__date,fontSize:10,children:T(new Date(c.createdAt),"hh:mm a")})]}),i&&o===0&&t(M,{url:a.profileImage,size:"small"})]},`chat_message_${c.id}_${o}`))})}function de({chatId:n,classes:e,loading:r,messages:a}){const{data:i}=w(),c=le(a);return u(O,{children:[r&&t(j,{id:"chat-messages-loader",text:"Cargando"}),c.map(({messages:o,title:d},h)=>{const l=h===c.length-1?o.reduce((p,y)=>!y[0].read&&y[0].senderId!==(i==null?void 0:i.id)?p+y.length:p,0):0;let m=!1;return u("div",{className:e.chatBox__content__grouped,id:h===c.length-1?"chat-grouped-messages":void 0,children:[t(f,{className:e.chatBox__content__grouped__title,fontSize:12,fontWeight:500,children:d}),t("div",{className:e.chatBox__content__grouped__messages,children:o.map((p,y)=>l>0&&!p[0].read&&p[0].senderId!==(i==null?void 0:i.id)&&!m?(m=!0,u(v.exports.Fragment,{children:[u(f,{withLetterSpacing:!0,className:e.chatBox__content__grouped__messages__unread,fontSize:12,children:[l," mensaje",l===1?"":"s"," no le\xEDdo",l===1?"":"s"]}),t(L,{classes:e,data:p})]},`chat_message_${n}_${p.length}_${h}_${y}`)):t(L,{classes:e,data:p},`chat_message_${n}_${p.length}_${h}_${y}`))})]},`chat_grouped_message_${o.length}_${h}`)})]})}function he({user:n}){return t(C,{fullHeight:!0,children:u(s,{container:!0,alignItems:"center",direction:"column",justifyContent:"center",spacing:12,children:[t(s,{item:!0,children:t(M,{size:"big",url:n.profileImage})}),t(s,{item:!0,children:t(f,{variant:"title",children:n.username})}),u(s,{item:!0,children:[t(F,{fullWidth:!0,link:!0,color:"white",size:"small",to:k.replace(":username",n.username),variant:"outlined",children:"Ver perfil"}),t(F,{color:"error",onClick:()=>{},size:"small",style:{marginTop:12},children:"Borrar conversaci\xF3n"})]})]})})}function me({chatId:n,classes:e,user:r}){const[a,i]=v.exports.useState(""),c=v.exports.useRef(null),{loadRecentChats:o,readAllMessages:d}=b(),{data:h}=w(),[l,{loading:m}]=V(W,{onCompleted(){i(""),o(),setTimeout(()=>{c.current&&c.current.focus()},100)}});function p(D){i(D.target.value)}function y(){h&&d(n,h.id)}function U(D){D.key==="Enter"&&a.length>0&&l({variables:{chatId:n,content:a}})}return t("div",{className:e.chatBox__footer,children:t(s,{container:!0,children:t(s,{item:!0,xs:"auto",children:t("input",{autoComplete:"off",className:e.chatBox__footer__input,disabled:m,onChange:p,onFocus:y,onKeyDown:U,placeholder:`Mensaje para ${r.username}`,ref:c,value:a})})})})}function ge({classes:n,onClick:e,user:r}){return t("div",{className:n.chatBox__header,children:u(s,{container:!0,alignItems:"center",justifyContent:"space-between",children:[t(s,{item:!0,children:t("button",{className:n.chatBox__header__button,onClick:e,children:u(s,{container:!0,alignItems:"center",spacing:12,children:[t(s,{item:!0,children:t(M,{clickable:!0,url:r.profileImage,size:"small"})}),t(s,{item:!0,children:t(f,{variant:"subtitle",children:r.username})})]})})}),t(s,{item:!0,children:t(Z,{color:"white",onClick:e,size:"small",variant:"transparent",children:t(ue,{})})})]})})}function fe({chatId:n}){const[e,r]=v.exports.useState(!1),[a,i]=v.exports.useState(!1),c=v.exports.useRef(null),{chats:o,loadChat:d}=b(),{data:h}=w(),l=o[n];if(v.exports.useEffect(()=>{l!=null&&l.chat||(i(!0),d(n).finally(()=>i(!1)))},[n]),v.exports.useEffect(()=>{!c.current||!(l!=null&&l.messages)||c.current.scrollTo(0,c.current.scrollHeight)},[l]),!(l!=null&&l.chat)||!h)return null;const m=l.chat.toId===h.id?l.chat.user:l.chat.toUser;return m?u(s,{container:!0,spacing:12,children:[t(s,{item:!0,style:{height:"calc(100vh - 48px - 50px)"},xs:e?9:12,children:u(C,{fullHeight:!0,noPadding:!0,className:I.chatBox,children:[t(ge,{classes:I,onClick:()=>r(!e),user:m}),t("div",{className:I.chatBox__content,ref:c,children:t(de,{chatId:n,classes:I,loading:a,messages:l.messages})}),t(me,{chatId:n,classes:I,user:m})]})}),e&&t(s,{item:!0,xs:3,children:t(he,{classes:I,user:m})})]}):null}function pe({data:n}){const{data:e}=w(),r=G();if(e==null)return null;const a=n.chat.toId===e.id?n.chat.user:n.chat.toUser;if(!a)return null;const i=new Date(n.lastMessage.createdAt),c=Y(i,new Date),o=te(i,new Date);return t(R,{className:N(A.messagePreview,{[A["messagePreview--active"]]:r.pathname===E.replace(":chatId",n.chat.id.toString())}),to:E.replace(":chatId",n.chat.id.toString()),children:u(s,{container:!0,alignItems:"center",spacing:24,children:[t(s,{item:!0,children:t(M,{url:a.profileImage})}),t(s,{item:!0,xs:9,children:u(s,{container:!0,justifyContent:"space-between",children:[t(s,{item:!0,children:t(f,{withLetterSpacing:!0,fontSize:18,fontWeight:500,children:a.username})}),t(s,{item:!0,children:t(f,{fontSize:12,children:c===1?"Ayer":T(i,c===0?"hh:mm a":`dd/MM${o===0?"":"/yy"}`)})}),t(s,{item:!0,xs:10,children:u(f,{style:{color:"#6A6B70",display:"block",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},variant:"body",children:[n.lastMessage.senderId===e.id?"T\xFA: ":null,n.lastMessage.content]})}),Boolean(n.unread)&&t(s,{item:!0,children:t(z,{counter:n.unread})})]})})]})})}function _e(){return u(s,{container:!0,fullHeight:!0,alignItems:"center",direction:"column",justifyContent:"center",spacing:16,children:[t(s,{item:!0,xs:4,children:t("img",{alt:"Begin chat",src:"/images/begin-chat.svg",width:"100%"})}),t(s,{item:!0,children:u(s,{container:!0,alignItems:"center",direction:"column",spacing:4,children:[t(s,{item:!0,children:t(f,{variant:"title",children:"Selecciona una conversaci\xF3n"})}),t(s,{item:!0,children:u(f,{variant:"body",children:["Si no tienes una conversaci\xF3n puedes buscar"," ",t(R,{to:"/explore",children:"nuevas conexiones"})]})})]})})]})}function ve(){const{recentChats:n,unreadChats:e}=b(),{chatId:r}=K();return t(J,{children:t(s,{item:!0,xs:12,children:u(s,{container:!0,fullHeight:!0,spacing:12,children:[t(s,{item:!0,children:t("div",{style:{height:"calc(100vh - 48px)",maxHeight:"calc(100vh - 48px)",width:320},children:u(C,{fullHeight:!0,noPadding:!0,children:[u(f,{withLetterSpacing:!0,component:"h3",style:{alignItems:"center",display:"flex",gap:8,padding:"16px 24px"},variant:"title",children:["Conversaciones",t(z,{counter:e})]}),n.length>0?n.map((a,i)=>t(pe,{data:a},`chat_${a.chat.id}_${i}`)):t(s,{container:!0,alignItems:"center",direction:"column",children:t(s,{item:!0,children:t(f,{children:"No tienes conversaciones"})})})]})})}),u(s,{item:!0,xs:"auto",children:[t(Q,{}),t("div",{style:{marginTop:12},children:r?t(fe,{chatId:r}):t(_e,{})})]})]})})})}export{ve as default};
